{% extends "internal_app/base.html" %}

{% block title %}Manage Devices{% endblock %}

{% block content %}
    {# Add a wider container specifically for the devices list #}
    <div class="container">
        <h1>Device Management</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if is_sudoer %}
            <a href="{{ url_for('.add_device') }}" class="btn-add">Add New Device</a>
        {% endif %}

        <div class="content-block">
            {% if devices %}
                <table>
                    <thead>
                        <tr>
                            <th>MAC Address</th>
                            <th>Description</th>
                            <th>VLAN Name</th>
                            {# Add Created At/Updated At if available and desired from User table #}
                            {# <th>Registered At</th> #}
                            {% if is_sudoer %}
                                <th>Actions</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for device_view in devices %}
                            <tr>
                                {# Use the formatted_mac property for display #}
                                <td>{{ device_view.formatted_mac }}</td>
                                <td>{{ device_view.description if device_view.description else 'N/A' }}</td>
                                <td>{{ device_view.vlan_name if device_view.vlan_name else 'N/A' }}</td>
                                {# <td>{{ device_view.user_created_at.strftime('%Y-%m-%d %H:%M:%S') if device_view.user_created_at else 'N/A' }}</td> #}
                                {% if is_sudoer %}
                                    <td class="actions">
                                        {# Pass the formatted MAC in the URL for consistency, routes.py will normalize it #}
                                        <a href="{{ url_for('.edit_device', mac_address_display=device_view.formatted_mac) }}" class="btn-edit">Edit</a>
                                        {# Pass the formatted MAC in the URL for consistency, routes.py will normalize it #}
                                        <form action="{{ url_for('.delete_device', mac_address_display=device_view.formatted_mac) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this device \'{{ device_view.formatted_mac }}\'?');">
                                            <button type="submit" class="btn-delete">Delete</button>
                                        </form>
                                    </td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="no-devices">No devices found. {% if is_sudoer %}Click "Add New Device" to get started.{% endif %}</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
